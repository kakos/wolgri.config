###### Gr!SHk@`s fdm config grishka@jabber.kiev.ua
#
# The following strings are replaced in pipe commands and maildir/mbox paths:
#       %a: account name
#       %h: user's home directory
#       %n: user's uid
#       %t: action name if performing action
#       %u: name of user
#       %H: current hour (00-23)
#       %M: current minute (00-59)
#       %S: current second (00-59)
#       %d: current day of the month (00-31)
#       %m: current month (01-12)
#       %y: current year
#       %W: current day of the week (0-6, Sunday is 0)
#       %Y: current day of the year (000-365)
#       %Q: current quarter (1-4)
set unmatched-mail keep
set maximum-size 128M
$maildir       = "%h/.Maildir"
### spam filter commands
$com_spam_filter = "spamprobe receive"
$com_train_good  = "spamprobe good"
$com_train_spam  = "spamprobe spam"
### some filters use these unix commands:
$com_sed        = "sed"
$com_awk        = "awk"
$com_perl       = "perl"
### spam header expressions
$header_spam    = "X-SpamProbe"
$filtered_spam  = "SPAM"
$filtered_good  = "GOOD"
$filter_trained = " TRAINED"
### accounts for spam-training
###   -asp-train-spam
###     trains the message from stdin as spam;
###     moves the mail to the appropriate folder
###   -asp-train-good
###     trains the message from stdin as ham;
###     continues with normal rules to sort the message
###     to the folder it belongs to.
account "sp-train-spam" disabled stdin
include "/home/wolgri/secret/fdm"
account "sp-train-good" disabled stdin
### sometimes you want to test new things by providing mails on stdin
account "stdin" disabled stdin
# Actions
### simple actions
action "drop" drop
action "keep" keep
action "inbox"			maildir ${maildir}
### list actions
action "lku"  maildir "${maildir}/.list.lku"
action "qgis" maildir "${maildir}/.list.qgis-user"
action "debian.fw" maildir "${maildir}/.list.debian.fw"
action "debian.ru" maildir "${maildir}/.list.debian.ru"
action "debian.sec" maildir "${maildir}/.list.debian.sec"
action "hh.asus" maildir "${maildir}/.list.hh.asus"
action "awesome" maildir "${maildir}/.list.awesome"
action "ol_u" maildir "${maildir}/.list.ol_user"

### spam actions
action "spam"		          maildir       "${maildir}/.spam"
action "train-spam"           pipe          "${com_train_spam}"
action "train-good"           pipe          "${com_train_good}"
action "sp-add-header"        add-header    "${header_spam}" "%[command1]"
action "sp-remove-header"     remove-header "${header_spam}"
action "sp-add-trained-good"  add-header    "${header_spam}" "${filtered_good}${filter_trained}"
action "sp-add-trained-spam"  add-header    "${header_spam}" "${filtered_spam}${filter_trained}"
# Matches
########## spam handling ##########
### force message from stdin to spamfolder and train it as spam
#match all account "sp-train-spam" {
#    match all action "train-spam" continue
#    match "^${header_spam}" in headers action "sp-remove-header" continue
#    match all action "sp-add-trained-spam" continue
#    match all action "spam"
#    }
### train message from stdin as ham
#match all
#account "sp-train-good"
#action "train-good"           continue
#match "^${header_spam}" in headers
#account "sp-train-good"
#action "sp-remove-header"     continue
#match all
#account "sp-train-good"
#action "sp-add-trained-good"  continue
### scan for spam
#match not "^${header_spam}" in headers {
#    match pipe "${com_spam_filter}" returns ( , "(.*)" ) {
#        match "^${header_spam}" in headers action "sp-remove-header" continue
#        match all action "sp-add-header" continue
#    }
#}
### move messages marked as spam to spamfolder
match "^${header_spam}:[ \t]*${filtered_spam}" in headers action "spam"
### Lists
match "^List-Id:.*linux.kiev.ua" in headers action "lku"
match "^List-Id:.*debian-firewall" in headers action "debian.fw"
match "^List-Id:.*debian-russian.lists.debian.org" in headers action "debian.ru"
match "^To:.*debian-russian@lists.debian.org" in headers action "debian.ru"

match "^List-Id:.*debian-security-announce" in headers action "debian.sec"
match "^List-Id:.*qgis-user.lists.qgis.org" in headers action "qgis"
match "^List-Id:.*qgis-user.lists.osgeo.org" in headers action "qgis"
match "^List-Id:.*asus-port.handhelds.org"  in  headers action "hh.asus"
match "^List-Id:.*awesome.naquadah.org" in headers action "awesome"
match "^List-Id:.*users.openlayers.org" in headers action "ol_u"
match "^To:.*users@openlayers.org"  in  headers action "ol_u"

### And finale 
match all action "inbox"
